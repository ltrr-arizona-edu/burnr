<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add composites to facet plots • burnr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Add composites to facet plots">
<meta property="og:description" content="burnr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">burnr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/Introduction.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Function help</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/facet_comps.html">Add composites to facet plots</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ltrr-arizona-edu/burnr" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="facet_comps_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Add composites to facet plots</h1>
                        <h4 data-toc-skip class="author">Chris Guiterman</h4>
            
            <h4 data-toc-skip class="date">2022-04-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ltrr-arizona-edu/burnr/blob/HEAD/vignettes/facet_comps.Rmd" class="external-link"><code>vignettes/facet_comps.Rmd</code></a></small>
      <div class="hidden name"><code>facet_comps.Rmd</code></div>

    </div>

    
    
<p>A limitation of ggplot graphics is an inability to use the <code>composite_rug</code> parameter within a facet generated by <code><a href="../reference/plot_demograph.html">plot_demograph()</a></code>. In this instance, one can make composites and add them to demograph plots within the facets, or stack the composites in a separate facet. We can use the color options of <code><a href="../reference/plot_demograph.html">plot_demograph()</a></code> to help distinguish between trees and site-level composites. This section will demonstrate how.</p>
<p>First, read in three related sites from the Jemez Mountains, New Mexico. These are available on the International Multiproxy Paleofire Database (IMPD).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ltrr-arizona-edu/burnr/" class="external-link">burnr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="co">## Files were obtained from the IMPD</span>
<span class="co"># url &lt;- "https://www1.ncdc.noaa.gov/pub/data/paleo/firehistory/firescar/northamerica/"</span>

<span class="va">pmr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_fhx.html">read_fhx</a></span><span class="op">(</span><span class="st">"uspmr001.fhx"</span><span class="op">)</span>
<span class="va">pme</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_fhx.html">read_fhx</a></span><span class="op">(</span><span class="st">"uspme001.fhx"</span><span class="op">)</span>
<span class="va">pmw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_fhx.html">read_fhx</a></span><span class="op">(</span><span class="st">"uspmw001.fhx"</span><span class="op">)</span></code></pre></div>
<p>To designate the different sites and data type (tree vs. composite in this case) we create metadata tables for each site from the fhx objects. If we had species information we color by species as well, and would add “composite” as a sort of species.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pmr.meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="../reference/series_names.html">series_names</a></span><span class="op">(</span><span class="va">pmr</span><span class="op">)</span>, site <span class="op">=</span> <span class="st">'PMR'</span>, type <span class="op">=</span> <span class="st">'Tree'</span><span class="op">)</span>
<span class="va">pme.meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="../reference/series_names.html">series_names</a></span><span class="op">(</span><span class="va">pme</span><span class="op">)</span>, site <span class="op">=</span> <span class="st">'PME'</span>, type <span class="op">=</span> <span class="st">'Tree'</span><span class="op">)</span>
<span class="va">pmw.meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="../reference/series_names.html">series_names</a></span><span class="op">(</span><span class="va">pmw</span><span class="op">)</span>, site <span class="op">=</span> <span class="st">'PMW'</span>, type <span class="op">=</span> <span class="st">'Tree'</span><span class="op">)</span></code></pre></div>
<p>Make the composite fire histories for each site.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pmr.comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/composite.html">composite</a></span><span class="op">(</span><span class="va">pmr</span>, comp_name <span class="op">=</span> <span class="st">'PMR.comp'</span><span class="op">)</span>
<span class="va">pme.comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/composite.html">composite</a></span><span class="op">(</span><span class="va">pme</span>, comp_name <span class="op">=</span> <span class="st">'PME.comp'</span><span class="op">)</span>
<span class="va">pmw.comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/composite.html">composite</a></span><span class="op">(</span><span class="va">pmw</span>, comp_name <span class="op">=</span> <span class="st">'PMW.comp'</span><span class="op">)</span></code></pre></div>
<p>Make a dataframe for the composites, and combine it with the tree-level data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">comp.meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'PMR.comp'</span>, <span class="st">'PME.comp'</span>, <span class="st">'PMW.comp'</span><span class="op">)</span>, 
                        site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'PMR'</span>, <span class="st">'PME'</span>, <span class="st">'PMW'</span><span class="op">)</span>, 
                        type <span class="op">=</span> <span class="st">'Composite'</span><span class="op">)</span></code></pre></div>
<p>Combine all of the fhx objects and the metadata tables. We add here the sort function to order the series in the fhx object. In this case, the preferred final look of the plot will be trees sorted by their inner-ring date. In the next step we’ll flip the series order to place the composites on the bottom of each facet, so here we sort the series in the opposite manner.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all.fhx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">pmr</span>, sort_by <span class="op">=</span> <span class="st">"first_year"</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
              <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">pme</span>, sort_by <span class="op">=</span> <span class="st">"first_year"</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
              <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">pmw</span>, sort_by <span class="op">=</span> <span class="st">"first_year"</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
              <span class="va">pmr.comp</span> <span class="op">+</span> <span class="va">pme.comp</span> <span class="op">+</span> <span class="va">pmw.comp</span>

<span class="va">all.meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">pmr.meta</span>, <span class="va">pme.meta</span>, <span class="va">pmw.meta</span>, <span class="va">comp.meta</span><span class="op">)</span></code></pre></div>
<p>To ensure the composite stays at the bottom of the facet, the factor order needs to be reversed.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all.fhx</span><span class="op">$</span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">all.fhx</span><span class="op">$</span><span class="va">series</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">all.fhx</span><span class="op">$</span><span class="va">series</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Make the fire-demography plot.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_demograph.html">plot_demograph</a></span><span class="op">(</span><span class="va">all.fhx</span>, facet_group <span class="op">=</span> <span class="va">all.meta</span><span class="op">$</span><span class="va">site</span>, 
               facet_id <span class="op">=</span> <span class="va">all.meta</span><span class="op">$</span><span class="va">series</span>,
               color_group <span class="op">=</span> <span class="va">all.meta</span><span class="op">$</span><span class="va">type</span>, 
               color_id <span class="op">=</span> <span class="va">all.meta</span><span class="op">$</span><span class="va">series</span>,
               ylabels <span class="op">=</span> <span class="cn">FALSE</span>, event_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,
               plot_legend <span class="op">=</span> <span class="cn">TRUE</span>, yearlims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1600</span>, <span class="fl">1995</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'red'</span>, <span class="st">'black'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'top'</span>, 
        legend.direction<span class="op">=</span><span class="st">"horizontal"</span>, 
        legend.background<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">'white'</span><span class="op">)</span>, 
        legend.box<span class="op">=</span><span class="st">"horizontal"</span><span class="op">)</span></code></pre></div>
<p><img src="facet_comps_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>To place the composites in their own facet, change the site ID to “composite”. Make sure the order in which the composites are added to the full fhx object matches the order of the tree-level site facets.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">comp.meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'PMR.comp'</span>, <span class="st">'PME.comp'</span>, <span class="st">'PMW.comp'</span><span class="op">)</span>, 
                        site <span class="op">=</span> <span class="st">'Composite'</span>, 
                        type <span class="op">=</span> <span class="st">'Composite'</span><span class="op">)</span>

<span class="va">all.meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">pmr.meta</span>, <span class="va">pme.meta</span>, <span class="va">pmw.meta</span>, <span class="va">comp.meta</span><span class="op">)</span>
<span class="va">all.meta</span><span class="op">$</span><span class="va">site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">all.meta</span><span class="op">$</span><span class="va">site</span>, 
                        levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PMR"</span>, <span class="st">"PME"</span>, <span class="st">"PMW"</span>, <span class="st">"Composite"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># use factor() to resort the facets, placing Composite on bottom</span>

<span class="fu"><a href="../reference/plot_demograph.html">plot_demograph</a></span><span class="op">(</span><span class="va">all.fhx</span>, 
               facet_group <span class="op">=</span> <span class="va">all.meta</span><span class="op">$</span><span class="va">site</span>, 
               facet_id <span class="op">=</span> <span class="va">all.meta</span><span class="op">$</span><span class="va">series</span>,
               ylabels <span class="op">=</span> <span class="cn">FALSE</span>, 
               event_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,
               plot_legend <span class="op">=</span> <span class="cn">TRUE</span>, 
               yearlims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1600</span>, <span class="fl">1995</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'top'</span>, 
        legend.direction<span class="op">=</span><span class="st">"horizontal"</span>, 
        legend.background<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">'white'</span><span class="op">)</span>, 
        legend.box<span class="op">=</span><span class="st">"horizontal"</span><span class="op">)</span></code></pre></div>
<p><img src="facet_comps_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Steven Malevich, Christopher Guiterman, Ellis Margolis.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
